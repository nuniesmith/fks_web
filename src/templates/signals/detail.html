{% extends 'base.html' %}
{% load static %}

{% block title %}Signal Details - {{ signal.symbol|default:"N/A" }} - FKS Trading Platform{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <a href="{% url 'web_app:signals_dashboard' %}?date={{ date }}" class="btn btn-outline-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
        <h2>
            <i class="bi bi-info-circle"></i>
            Signal Details: {{ signal.symbol|default:"N/A" }}
        </h2>
    </div>
</div>

{% if signal %}
<div class="row">
    <!-- Main Signal Information -->
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Signal Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Symbol:</strong> {{ signal.symbol|default:"N/A" }}
                    </div>
                    <div class="col-md-6">
                        <strong>Signal Type:</strong> 
                        <span class="badge bg-{% if signal.signal_type == 'BUY' %}success{% else %}danger{% endif %}">
                            {{ signal.signal_type|default:"N/A" }}
                        </span>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Category:</strong> 
                        <span class="badge bg-primary">{{ signal.category|default:"N/A"|title }}</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Timestamp:</strong> {{ signal.timestamp|default:"N/A" }}
                    </div>
                </div>
                
                <hr>
                
                <h6>Price Levels</h6>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <small class="text-muted d-block">Entry Price</small>
                                <h4 class="mb-0">${{ signal.entry_price|default:"0.00"|floatformat:2 }}</h4>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <small class="d-block">Take Profit</small>
                                <h4 class="mb-0">${{ signal.take_profit|default:"0.00"|floatformat:2 }}</h4>
                                <small>+{{ signal.take_profit_pct|default:0|floatformat:2 }}%</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-danger text-white">
                            <div class="card-body text-center">
                                <small class="d-block">Stop Loss</small>
                                <h4 class="mb-0">${{ signal.stop_loss|default:"0.00"|floatformat:2 }}</h4>
                                <small>-{{ signal.stop_loss_pct|default:0|floatformat:2 }}%</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="row">
                    <div class="col-md-6">
                        <strong>Risk/Reward Ratio:</strong> 
                        <span class="badge bg-info">{{ signal.risk_reward_ratio|default:0|floatformat:2 }}</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Confidence:</strong> 
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar {% if signal.confidence >= 80 %}bg-success{% elif signal.confidence >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                 role="progressbar" 
                                 style="width: {{ signal.confidence|default:0 }}%"
                                 aria-valuenow="{{ signal.confidence|default:0 }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                                {{ signal.confidence|default:0|floatformat:0 }}%
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if signal.strength %}
                <div class="row mt-3">
                    <div class="col-md-6">
                        <strong>Signal Strength:</strong> 
                        <span class="badge bg-secondary">{{ signal.strength }}</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Lot Size Information -->
        {% if signal.lot_size %}
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Position Sizing</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-muted">Risk Amount</h6>
                        <h4>${{ signal.lot_size.risk_amount_usd|default:0|floatformat:2 }}</h4>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted">Position Size</h6>
                        <h4>${{ signal.lot_size.position_size_usd|default:0|floatformat:2 }}</h4>
                    </div>
                    {% if signal.lot_size.token_amount %}
                    <div class="col-md-4">
                        <h6 class="text-muted">Token Amount</h6>
                        <h4>{{ signal.lot_size.token_amount|default:0|floatformat:4 }}</h4>
                    </div>
                    {% endif %}
                </div>
                {% if signal.lot_size.leverage %}
                <div class="mt-3">
                    <small class="text-muted">Leverage: {{ signal.lot_size.leverage|default:1.0 }}x</small>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <!-- Entry Planning -->
        {% if signal.entry_planning %}
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Entry Planning</h5>
            </div>
            <div class="card-body">
                {% if signal.entry_planning.market_open_time %}
                <div class="alert alert-info">
                    <h6>Market Opens:</h6>
                    <p class="mb-0">{{ signal.entry_planning.market_open_time }}</p>
                    <div id="countdown-timer" class="countdown-timer mt-2">Loading...</div>
                </div>
                {% else %}
                <div class="alert alert-success">
                    <h6>24/7 Market (Crypto)</h6>
                    <p class="mb-0">You can enter this trade at any time. No market open/close restrictions.</p>
                </div>
                {% endif %}
                
                {% if signal.entry_planning.recommended_order_type %}
                <div class="mt-3">
                    <strong>Recommended Order Type:</strong> 
                    <span class="badge bg-primary">{{ signal.entry_planning.recommended_order_type }}</span>
                </div>
                {% endif %}
                
                {% if signal.entry_planning.time_until_open %}
                <div class="mt-3">
                    <strong>Time Until Market Open:</strong> {{ signal.entry_planning.time_until_open }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-success w-100 mb-2">
                    <i class="bi bi-check-circle"></i> Approve Signal
                </button>
                <button class="btn btn-danger w-100 mb-2">
                    <i class="bi bi-x-circle"></i> Reject Signal
                </button>
                <a href="{% url 'web_app:signals_dashboard' %}?date={{ date }}" class="btn btn-outline-secondary w-100">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
        
        {% if signal.indicators %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Technical Indicators</h5>
            </div>
            <div class="card-body">
                {% for key, value in signal.indicators.items %}
                <div class="mb-2">
                    <strong>{{ key }}:</strong> {{ value }}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% else %}
<div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle"></i>
    Signal not found or could not be loaded.
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// Countdown timer for market open
document.addEventListener('DOMContentLoaded', function() {
    const countdownElement = document.getElementById('countdown-timer');
    if (countdownElement) {
        // Countdown logic would go here
        countdownElement.textContent = 'Market open time available';
    }
});
</script>
{% endblock %}

