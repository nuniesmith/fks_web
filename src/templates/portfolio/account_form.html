{% extends "base.html" %}
{% load static %}

{% block title %}{% if object %}Edit{% else %}Add{% endif %} Account{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1>{% if object %}Edit{% else %}Add{% endif %} Account</h1>
            
            <form method="post">
                {% csrf_token %}
                
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.account_type.id_for_label }}" class="form-label">{{ form.account_type.label }}</label>
                            {{ form.account_type }}
                            <small class="form-text text-muted">
                                <strong>Prop Firm:</strong> Trading accounts with prop firms (FTMO, TopStep, etc.)<br>
                                <strong>Personal Trading:</strong> Your own active trading accounts (short-term)<br>
                                <strong>Retirement:</strong> Long-term retirement accounts (RRSP, TFSA, 401k, IRA)<br>
                                <strong>Taxable:</strong> Long-term taxable investment accounts
                            </small>
                            {% if form.account_type.errors %}
                                <div class="text-danger">{{ form.account_type.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.account_name.id_for_label }}" class="form-label">{{ form.account_name.label }}</label>
                            {{ form.account_name }}
                            {% if form.account_name.errors %}
                                <div class="text-danger">{{ form.account_name.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.firm_name.id_for_label }}" class="form-label">{{ form.firm_name.label }}</label>
                            {{ form.firm_name }}
                            {% if form.firm_name.errors %}
                                <div class="text-danger">{{ form.firm_name.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.account_number.id_for_label }}" class="form-label">{{ form.account_number.label }}</label>
                            {{ form.account_number }}
                            {% if form.account_number.errors %}
                                <div class="text-danger">{{ form.account_number.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.current_balance.id_for_label }}" class="form-label">{{ form.current_balance.label }}</label>
                                {{ form.current_balance }}
                                {% if form.current_balance.errors %}
                                    <div class="text-danger">{{ form.current_balance.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.currency.id_for_label }}" class="form-label">{{ form.currency.label }}</label>
                                {{ form.currency }}
                                {% if form.currency.errors %}
                                    <div class="text-danger">{{ form.currency.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-3" id="drawdown-field">
                            <label for="{{ form.drawdown_limit.id_for_label }}" class="form-label">{{ form.drawdown_limit.label }}</label>
                            {{ form.drawdown_limit }}
                            <small class="form-text text-muted">Mainly for prop firm accounts. Leave blank if not applicable.</small>
                            {% if form.drawdown_limit.errors %}
                                <div class="text-danger">{{ form.drawdown_limit.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <script>
                        // Show/hide drawdown field based on account type
                        document.addEventListener('DOMContentLoaded', function() {
                            const accountType = document.getElementById('id_account_type');
                            const drawdownField = document.getElementById('drawdown-field');
                            
                            function toggleDrawdown() {
                                if (accountType.value === 'prop_firm') {
                                    drawdownField.style.display = 'block';
                                } else {
                                    drawdownField.style.display = 'block'; // Keep visible but optional
                                }
                            }
                            
                            accountType.addEventListener('change', toggleDrawdown);
                            toggleDrawdown(); // Initial check
                        });
                        </script>
                        
                        <div class="mb-3">
                            <label for="{{ form.instruments_allowed.id_for_label }}" class="form-label">{{ form.instruments_allowed.label }}</label>
                            {{ form.instruments_allowed }}
                            {% if form.instruments_allowed.errors %}
                                <div class="text-danger">{{ form.instruments_allowed.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.restrictions.id_for_label }}" class="form-label">{{ form.restrictions.label }}</label>
                            {{ form.restrictions }}
                            {% if form.restrictions.errors %}
                                <div class="text-danger">{{ form.restrictions.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.notes.id_for_label }}" class="form-label">{{ form.notes.label }}</label>
                            {{ form.notes }}
                            {% if form.notes.errors %}
                                <div class="text-danger">{{ form.notes.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3 form-check">
                            {{ form.active }}
                            <label for="{{ form.active.id_for_label }}" class="form-check-label">{{ form.active.label }}</label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">Save Account</button>
                    <a href="{% url 'portfolio:account_inventory' %}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

